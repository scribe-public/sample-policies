attest:
  cocosign:
    policies:
    - name: git-policy
      enable: true
      modules:
      - name: no-main
        type: verify-artifact
        enable: true
        input:
          signed: false
          format: statement-cyclonedx-json
          match:
            target_type: git
          rego:
                script: |
                  package verify

                  default allow = false
                  default branch = "wtfbr"
                  
                  verify = v {
                          v := {
                          "allow": allow,
                              "summary": [{
                              "allow": allow,
                              "reason":  "Found commits to main branch",
                          }]
                      }
                  }

                  branch = input.evidence.predicate.environment.git_branch

                  allow {
                    branch != "main"
                  }
