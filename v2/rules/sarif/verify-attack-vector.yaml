config-type: rule
id: sarif-attack-vectors
name: Verify Attack Vector Exists in SARIF
path: verify-attack-vector.rego

description: Verify required evidence validates attack vectors in the SARIF report.
mitigation: >
  Helps prevent the deployment of images vulnerable to specific attack vectors by ensuring that any findings
  related to disallowed attack vectors are detected and flagged. This rule minimizes potential exploitation paths
  by enforcing that only acceptable vulnerability profiles are present.

full-description: |  
  This rule evaluates the SARIF report produced by the Vulnerability Scanner to verify that vulnerabilities
  associated with specific attack vectors are properly identified. The rule works as follows:
  
  1. It iterates over the vulnerability results in the SARIF report (from `input.evidence.predicate.content.runs[0].results`).
  2. For each result, it retrieves the corresponding rule definition from 
     `input.evidence.predicate.content.runs[0].tool.driver.rules` based on the result's ruleIndex.
  3. The rule checks if the ruleâ€™s full description contains the phrase "The attack vector is" and whether it 
     includes any of the attack vectors specified in the configuration (`with.attack_vectors`).
  4. If such a vulnerability is found and the total number of matching findings exceeds the configured threshold 
     (`with.violations_threshold`), a violation is recorded. The violation includes the rule identifier and the 
     associated description.
  
  **Evidence Requirements:**
  
  - Evidence must be provided in a generic format adhering to the SARIF 2.1.0 schema.
  - The SARIF report should be generated by a tool like the Vulnerability Scanner.
  - The report must include detailed rule definitions and descriptions that mention attack vectors.

labels:
  - SARIF

evidence:
  signed: false
  content_body_type: generic
  target_type: data
  predicate_type: http://docs.oasis-open.org/sarif/sarif/2.1.0

with:
  attack_vectors: []
  violations_threshold: 0
