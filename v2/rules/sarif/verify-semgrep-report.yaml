config-type: rule
id: sarif-semgrep-report
name: Verify Semgrep Rule in SARIF
path: blocklist-report.rego

description: Verify the Semgrep SARIF report complies with predefined rules to ensure compliance and detect issues.

mitigation: >
  Ensures that any violations detected in the SARIF report produced by Semgrep are promptly identified and flagged,
  helping to prevent the use of assets that do not meet the required security standards.

full-description: |  
  This rule evaluates the SARIF report generated by Semgrep to verify that it complies with a set of predefined compliance rules.
  It iterates over the vulnerability results in the SARIF report (located under 
  `input.evidence.predicate.content.runs[0].results`) and retrieves the corresponding rule definitions 
  from `input.evidence.predicate.content.runs[0].tool.driver.rules` based on each result's ruleIndex.
  
  The rule checks whether the resultâ€™s ruleId contains any of the identifiers specified in the configuration (`with.rule_ids`).
  If the total number of matching findings exceeds the allowed threshold (specified by `with.violations_threshold`), a violation is recorded.
  Each violation includes details such as the rule identifier, the extracted severity, and the location of the finding.
  
  ### **Evidence Requirements**
  
  - Evidence must be provided in a generic format conforming to the SARIF 2.1.0 schema.
  - The SARIF report should be generated by Semgrep.
  - The report must include detailed rule definitions and descriptions that support matching against the specified blocklist.

labels:
  - SARIF
  - Semgrep

evidence:
  signed: false
  content_body_type: generic
  target_type: data
  predicate_type: http://docs.oasis-open.org/sarif/sarif/2.1.0

with:
  rule_ids: []
  violations_threshold: 0

inputs:
  - name: rule_level
    type: array
    description: List of rule levels to check for in the SARIF report.
    required: false
  - name: precision
    type: array
    description: List of precision levels to check for in the SARIF report.
    required: false
  - name: rule_ids
    type: array
    description: List of rule IDs to check for in the SARIF report.
    required: false
  - name: ignore
    type: array
    description: List of rule IDs to ignore in the SARIF report.
    required: false
  - name: max_allowed
    type: integer
    description: The maximum number of allowed violations.
    required: false
